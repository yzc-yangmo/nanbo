



<!DOCTYPE HTML>
<html>
  <head>
    
    <title>门票预约 - 南京博物院</title>
    
	<meta http-equiv="pragma" content="no-cache">
	<meta http-equiv="cache-control" content="no-cache">
	<meta http-equiv="expires" content="0">    
	<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
	<meta http-equiv="description" content="This is my page">
    <link rel="stylesheet" type="text/css" href="/reservation/static/css/global.css" />
    <link rel="stylesheet" type="text/css" href="/reservation/static/css/recommon.css?vi=230710" />
    <script type="text/javascript" src="/reservation/static/js/jquery-1.8.2.min.js"></script>
    <script src="/reservation/static/js/jquery.validate.js" type="text/javascript"></script>
	<link href="/reservation/static/css/jquery.validate.css" rel="stylesheet" type="text/css" >
	<script src="/reservation/static/js/jquery.validate.message_cn.js" type="text/javascript"></script>
	<script src="/reservation/static/js/card.js?vi=230710" type="text/javascript"></script>
	<script type="text/javascript" src="/reservation/static/layer/layer.js"></script>
  </head>
  
  <body>
    <div class="cont-right">
        <div class="wh">当前位置：<a href="http://www.njmuseum.com/">首页</a>&gt;<a target="_blank" href="/reservation/home.jsp">预约</a>&gt;参观预约</div>
        <div class="cm-box">
        	<h3 class="cm-title">预约信息填写</h3>
            <div class="visitor-box">
            	<form id="form" name="form" method="post" action="/reservation/ticketOut/out/saveOrderPC.do">
            		<input type="hidden" name="token" value="b58429aa-37a6-452e-bd14-66279b2e2b84"/>
            		<input type="hidden" name="date" value="2024-04-10" id="date">
            		<input type="hidden" name="ticketType" value="normal">
            		<input type="hidden" id="morAft" name="morAft" value="">
            		
            		
                		<div class="info-row"><span>预约日期：2024-04-10</span></div>
                		<div class="info-row"><span>参观环境：</span>
                			<span class="istar istars"></span>
                			<span class="istar istara"></span>
                			<span class="istar istara"></span>
                			<span class="istar istara"></span>
                			<span class="color333 va-center">
                				
                					
                						十分拥挤<span class="color999">（建议错峰出行）</span>
                					
                					
                					
                					
                				
                			</span>
                		</div>
                    <div class="info-row info-rowauto"><span class="info-rowtit">进馆时间：</span>
                    		<div class="info-rowse">
                        	<div>
                        		<button class="time-btn ntime-btn" type="button" id="mor">上午<span>（9:00-12:00）</span></button>
                        		<!-- 
                        		
                        		 -->
                        		
                        			
                        			
                        				<span class="grayc-tip">已无票</span>
                        			
                        			
                        		
                        	</div>
                        	
	                        	<div>
	                        		<button class="time-btn on " type="button" id="aft">下午<span>（12:00-16:00）</span></button>
	                        		
	                        			
	                        			
	                        			
	                        				<span class="red-tip">余票531张</span>
	                        			
	                        		
	                        	</div>
                        	
                        </div>
                    </div>
                    <!--  
                    <div class="info-row"><p class="gray-tipp">温馨提示：上午票请于当天13:00前进馆（逢周一请于上午11:00点前进馆，节假日除外），下午票请于当天12:00~16:00之间进馆。</p></div>
                    -->
                    <div class="info-row">
                    	<span class="ctext">温馨提示：参观人在添加后30天内不允许删除，每个账号最多添加5个常用参观人</span>
                    	<div class="clearfix">
                        	<span class="sel-txt">选择参观人：</span>
                            <div class="right">
                                <button class="cm-btn addcm-btn" type="button" onclick="toAdd()">新增</button>
                            </div>
                        </div>
                        <table class="info-tb" border="0" cellpadding="0" cellspacing="0" id="linkmansTb">
                            <tr>
                            	<th></th>
                                <th>姓名</th>
                                <th>证件号</th>
                                <th>操作</th>
                            </tr>
                            
                            <tr id="tr24389759">
                            	
                            		<td><input name="ids" type="checkbox" value="24389759"/></td>
                            		
                            	
                                <td>杨自创</td>
                                <td>4107*************2</td>
                                <td><a class="del-btn" href="javascript:delLinkman(24389759);">删除</a></td>
                            </tr>
                            
                            
                            <tr id="tr24389829">
                            	
                            		<td><input name="ids" type="checkbox" value="24389829"/></td>
                            		
                            	
                                <td>陈如义</td>
                                <td>3425*************8</td>
                                <td><a class="del-btn" href="javascript:delLinkman(24389829);">删除</a></td>
                            </tr>
                            
                            
                            <tr id="tr24389837">
                            	
                            		<td><input name="ids" type="checkbox" value="24389837"/></td>
                            		
                            	
                                <td>徐浩</td>
                                <td>3425*************3</td>
                                <td><a class="del-btn" href="javascript:delLinkman(24389837);">删除</a></td>
                            </tr>
                            
                            
                            <tr id="tr24389844">
                            	
                            		<td><input name="ids" type="checkbox" value="24389844"/></td>
                            		
                            	
                                <td>王壮苗</td>
                                <td>3307*************2</td>
                                <td><a class="del-btn" href="javascript:delLinkman(24389844);">删除</a></td>
                            </tr>
                            
                            
                        </table>
                        <p id="orderNum" style="display: none"></p>
                    </div>
                    <div class="info-row info-rowbtn">
                        <input class="login-btn" type="button" id="ss" value="提交" onclick="order()"/>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- 新增参与人 -->
    <div class="modal-mask"></div>
    <div class="modal-box">
    	<form id="form1" name="form1" method="post">
        <div class="modal-title">
        	<span>新增参与人<span class="font13">(上限5人)</span></span>
        </div>
    	<div class="modal-content">
    		<div class="login-item">
                <label class="label-text">证件类型：</label>
                <div class="tipinfo">
                	<select id="type" name="type" class="select">
                		<option value="0">身份证</option>
                		<option value="1">港澳台居民居住证</option>
                		<option value="2">护照</option>
                		<option value="3">港澳居民来往内地通行证</option>
                		<option value="4">台湾居民来往大陆通行证</option>
                		<option value="5">外国人永久居留身份证</option>
                	</select>
                </div>
            </div>
            <div class="login-item">
                <label class="label-text">姓名：</label>
                <div class="tipinfo">
                	<input class="input-text" type="hidden" id="id" name="id">
               	 	<input class="input-text" type="text" id="name" name="name" onkeyup="this.value=this.value.replace(/^ +| +$/g,'')" autocomplete="off">
                </div>
            </div>
            <div class="login-item">
                <label class="label-text">证件号：</label>
                <div class="tipinfo">
                	<input class="input-text" type="text" id="cardNo" name="cardNo" onkeyup="this.value=this.value.replace(/^ +| +$/g,'')" autocomplete="off">
                </div>
            </div>
        </div>
    	<div class="modal-btn">
            <input class="confirm-btn" type="submit" value="保存" id="s1"/>
            <input class="cancel-btn" type="button" value="取消" onclick="closeMask()"/>
            <input style="display:none" class="cancel-btn" type="reset" value="取消" />
        </div>
        </form>
    </div>
    <script type="text/javascript">
    	var fm1 ;
		$(function(){
			var morSurplusNum='0';
			var aftSurplusNum='531';
			if(morSurplusNum>0){
				$("#morAft").val("上午");
			}else if(aftSurplusNum>0){
				$("#morAft").val("下午");
			}
			
 		 	//全选
			$("#allCheck").change(function(){
				var allCheck=$("#allCheck").attr('checked');
				if(allCheck){
					if($("input[name='ids']").length>5){
						layer.alert("选择参观人数不得超过5人！");
						$("#allCheck").attr('checked',false);
					}else{
						$("input[name='ids']").each(function(){
							$(this).attr('checked',true);
						});
						var orderNum=$("input[name='ids']").length;
						$("#orderNum").html("本次预约人数："+orderNum+"人");
						$("#orderNum").show();
					}
				}else{
					$("input[name='ids']").each(function(){
						$(this).attr('checked',false);
					});
					$("#orderNum").hide();
				}
			});
			
			//选择显示人数
			/*$("input[name='ids']").change(function() {
				var orderNum=$("input:checkbox:checked").length;
				if(orderNum>0){
					$("#orderNum").html("本次预约人数："+orderNum+"人");
					$("#orderNum").show();
				}else{
					console.log(orderNum)
					$("#orderNum").hide();
				}
			});*/
		
			//联系人验证
			jQuery.validator.addMethod("isIdCardNo", function(value, element) { 
				var type = $("#type").val();
			  return this.optional(element) || idCardNoUtil.checkIdCardNo(value,type);
			}, "请正确输入您的证件号");
			fm1 = $('#form1').validate({
				ignore: ":disabled",
				rules: {
					name:{
						required:true
					},
					cardNo:{
						required:true,
						isIdCardNo:true
					}
				},
				messages: {
					name:{
        		required:"请输入姓名"
        	},
        	cardNo:{
        		required:"请输入证件号"
        	}
        },
        errorElement:"label",
     	  errorPlacement: function(error, element){
     	      error.appendTo(element.parent(".tipinfo"));
     	  },
	        	submitHandler:function(form){
	        		var index = layer.load();
		        	$("#s1").attr("disabled",true);
	        	  	$.ajax({  
		                type:"POST", 
		                url: "/reservation/ticketOut/out/saveLinkmanPCAll.do", 
		                data: $('#form1').serialize(),  
		                dataType:"json", 
		                async:false,
		                success: function(data){
		                	layer.close(index);
		                	if(data===0){
		                		$("#s1").attr("disabled",false);
		                		layer.alert('操作失败，该证件号在黑名单中！');
		                	}else if(data==-1){
		                		$("#s1").attr("disabled",false);
		                		layer.alert('操作失败，已有该证件号的联系人！');
		                	}else if(data==-2){
		                		$("#s1").attr("disabled",false);
		                		layer.alert('请先登录', {
								  closeBtn: 0
								}, function(){
									parent.location.href="/reservation/userOut/outSingle/toLoginSingle.do";
								});
		                	}else if(data==-3){
		                		$("#s1").attr("disabled",false);
		                		layer.alert('操作失败，请输入正确的证件号！');
		                	}else if(data==-4){
		                		$("#s1").attr("disabled",false);
		                		layer.alert('操作失败，最多添加五个联系人！');
		                	}else if(data==-5){
		                		$("#s1").attr("disabled",false);
		                		layer.alert('操作失败，请输入正确的姓名！');
		                	}else if(data>0){
		                		var id=$("#id").val();
		                		var name=$("#name").val();
		                		var cardNo=$("#cardNo").val();
		                		var cardNoS= cardNo.replace(cardNo.substring(4,cardNo.length-1),"*************");
		                		if(id&&id!=""){
		                			//修改
		                			var str="<td><input name=\"ids\" type=\"checkbox\" value=\""+id+"\" />"+
		                					"</td><td>"+name+"</td><td>"+cardNoS+"</td><td>"+
		                					"<a class=\"del-btn\" href=\"javascript:delLinkman("+id+");\">删除</a></td>";
		                			$("#tr"+id).html(str);
		                		}else{
		                			id=data;
		                			var str="<td><input name=\"ids\" type=\"checkbox\" value=\""+id+"\" />"+
		                					"</td><td>"+name+"</td><td>"+cardNoS+"</td><td>"+
		                					"<a class=\"del-btn\" href=\"javascript:delLinkman("+id+");\">删除</a></td>";
		                			$("#linkmansTb").append("<tr id=\"tr"+id+"\">"+str+"</tr>");
		                		}
		                		closeMask();
		                	}else{
		                		$("#s1").attr("disabled",false);
		                		layer.alert('操作失败');
		                	}
		                }, error: function(XMLHttpRequest, textStatus) {
		                	$("#s1").attr("disabled",false);
		                	layer.close(index);
		                	layer.alert('网络异常或非法操作');
		                },   
		            });
	        	  	
		        }
			});
			
			//上午下午切换
			$('#mor').on('click', function() {
				if(morSurplusNum>0){
					$(this).addClass("on");
					$("#aft").removeClass("on");
					$("#morAft").val('上午');
				}
			});
			
			$('#aft').on('click', function() {
				if(aftSurplusNum>0){
					$(this).addClass("on");
					$("#mor").removeClass("on");
					$("#morAft").val('下午');
				}
			});
		});
		
		function toAdd(){
			$(".modal-mask, .modal-box").show();
			$("#name").val();
			$("#cardNo").val();
			$("#id").val();
		}
		
		function toModify(name,cardNo,id){
			$(".modal-mask, .modal-box").show();
			$("#name").val(name);
			$("#cardNo").val(cardNo);
			$("#id").val(id);
		}
		
		function closeMask(){
			$(".modal-mask, .modal-box").hide();
			$("#name").val();
			$("#cardNo").val();
			$("#id").val();
			$("#s1").attr("disabled",false);
			fm1.resetForm();
			$("input[type=reset]").trigger("click");
		}
		
		function delLinkman(id){
			layer.confirm('您确定要删除该联系人？', 
				function(){
				  var index=layer.load();
				  $.ajax({  
		                type:"POST", 
		                url: "/reservation/ticketOut/out/delLinkmanPC.do", 
		                data: {'id':id},  
		                dataType:"json", 
		                async:false,
		                success: function(data){
		                	layer.close(index);
		                	if(data==1){
		                		layer.msg('操作成功');
		                		$("#tr"+id).remove();
		                	}else if(data==-2){
				        		layer.msg("非法操作");
				        	}else if(data==-3){
				        		layer.msg("该联系人暂不可进行删除操作");
				        	}else{
				        		layer.alert("删除失败！");
		                	}
		                }, error: function(XMLHttpRequest, textStatus) {
		                	layer.close(index);
		                	layer.alert("网络异常！");
		                },  
		            });
				}
			);
		}
		
		function order(){
			layer.confirm('1、<font color="#df3d3e">同一账号</font>7天内2次、30天内5次预约但未履约（预约后自行取消、参观日未到馆参观均视为未履约），该账号将被限制180天预约。<br>2、预约成功<font color="#df3d3e">当日可进馆两次</font>，请合理规划行程和参观路线。', {
			  btn: ["确认预约","我再想想"], //可以无限个按钮,
			  title:'提示',
			  closeBtn: 0,
			  yes: function(index, layero){
			  	var lindex = layer.load();
	       	  	$("#ss").attr("disabled",true);
	       	  	var morAft=$("#morAft").val();
	       	  	if(morAft!=''){
		       	  	var num=$("input:checkbox:checked").length;
					if(num<1){
						layer.close(lindex);
		        		$("#ss").attr("disabled",false);
						layer.alert("请至少选择一个预约人！");
					}else if(num>5){
						layer.close(lindex);
		        		$("#ss").attr("disabled",false);
						layer.alert("最多只能预约5个人！");
					}else{
						$("#form").submit();
					}
				}else{
					layer.close(lindex);
					$("#ss").attr("disabled",false);
					layer.alert("所选时间段无票!");
				}
			  }
			});
			
		}
		
    </script>
    <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1281245212'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1281245212%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</body>
</html>
